#!/usr/bin/env ruby

require File.dirname(__FILE__) + '/../lib/word_search'

$DEBUG = true

FileUtils.rm_rf "INDEX-test"

s = Time.now

field_infos = WordSearch::FieldInfos.new
field_infos.add_field(:name => :uri,  :analyzer => FileNameAnalyzer.new)
if ARGV.include?("--total")
  field_infos.add_field(:name => :body, :analyzer => WordSearch::Analysis::TotalAnalyzer.new)
else
  field_infos.add_field(:name => :body, :analyzer => WordSearch::Analysis::SimpleIdentifierAnalyzer.new)
end

fragment  = WordSearch::FragmentWriter.new("INDEX-test")
fragment.field_infos = field_infos

dir = ARGV[0]
files = `find #{dir} -name "*.rb"`
filenames = files.split("\n")
filenames.each do |filename|
  body = File.read(filename)
  puts "adding #{filename} -- #{body.size}"
  fragment.add_document(:uri => filename, :body => body)
end

puts "writing"
fragment.finish!
puts "took #{Time.now - s}s"


