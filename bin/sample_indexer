#!/usr/bin/env ruby

require File.dirname(__FILE__) + '/../lib/word_search'

$DEBUG = true

FileUtils.rm_rf "INDEX-test"

s = Time.now

field_infos = WordSearch::FieldInfos.new
field_infos.add_field(:name => :uri,  :analyzer => FileNameAnalyzer.new)
field_infos.add_field(:name => :body, :analyzer => WordSearch::Analysis::SimpleIdentifierAnalyzer.new)

fragment  = WordSearch::FragmentWriter.new("INDEX-test")
fragment.field_infos = field_infos

file_list = Dir[ARGV[0]]

file_list[0, file_list.size/1].each do |file|
  body = File.read(file)
#  puts "adding #{file} -- #{body.size}"
  fragment.add_document(:uri => file, :body => body)
end

puts "writing"
fragment.finish!
puts "took #{Time.now - s}s"


